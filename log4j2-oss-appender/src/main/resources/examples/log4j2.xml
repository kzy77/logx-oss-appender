<?xml version="1.0" encoding="UTF-8"?>
<!-- Log4j2 XML配置示例：OSS日志上传配置 -->
<Configuration status="WARN">
    
    <!-- 全局属性定义 -->
    <Properties>
        <Property name="LOG_PATTERN">%d{ISO8601} [%t] %-5level %logger{36} - %msg%n</Property>
        <Property name="APP_NAME">my-application</Property>
        <Property name="APP_ENV">prod</Property>
    </Properties>

    <Appenders>
        <!-- 控制台Appender -->
        <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="${LOG_PATTERN}" charset="UTF-8"/>
        </Console>

        <!-- OSS Appender：上传日志到对象存储 -->
        <OSS name="OSS"
             endpoint="${sys:LOGX_OSS_ENDPOINT:-https://oss-cn-hangzhou.aliyuncs.com}"
             region="${sys:LOGX_OSS_REGION:-cn-hangzhou}"
             accessKeyId="${sys:LOGX_OSS_ACCESS_KEY_ID}"
             accessKeySecret="${sys:LOGX_OSS_ACCESS_KEY_SECRET}"
             bucket="${sys:OSS_BUCKET:-${APP_NAME}-logs}"
             keyPrefix="logs/${APP_ENV}/">
            <PatternLayout pattern="${LOG_PATTERN}"/>
        </OSS>

        <!-- 文件Appender（可选，本地备份） -->
        <RollingFile name="FileAppender" fileName="logs/application.log"
                     filePattern="logs/application-%d{yyyy-MM-dd}-%i.log.gz">
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <TimeBasedTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="100MB"/>
            </Policies>
            <DefaultRolloverStrategy max="30"/>
        </RollingFile>

        <!-- 异步Appender（可选，进一步提升性能） -->
        <AsyncAppender name="AsyncOSS" bufferSize="2048">
            <AppenderRef ref="OSS"/>
        </AsyncAppender>
    </Appenders>

    <Loggers>
        <!-- 特定Logger配置：业务日志 -->
        <Logger name="com.mycompany.business" level="DEBUG" additivity="false">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="OSS"/>
        </Logger>

        <!-- 第三方库日志：只输出到控制台 -->
        <Logger name="org.springframework" level="WARN" additivity="false">
            <AppenderRef ref="Console"/>
        </Logger>

        <Logger name="com.alibaba" level="INFO" additivity="false">
            <AppenderRef ref="Console"/>
        </Logger>

        <!-- 根Logger配置 -->
        <Root level="INFO">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="OSS"/>
            <AppenderRef ref="FileAppender"/>
        </Root>
    </Loggers>

</Configuration>
